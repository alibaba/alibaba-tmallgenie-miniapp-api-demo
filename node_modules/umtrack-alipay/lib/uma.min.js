"use strict";function n(n){return my.request?my.request(n):my.httpRequest(n)}function t(t){try{G.getNetworkInfo(function(e){if("NOTREACHABLE"===e.networkType||"none"===e.networkType||!1===e.networkAvailable){b().e("请求失败:暂无网络 ");t.fail()}else n(t)},t.fail)}catch(n){b().e("请求失败: "+n)}}function e(n){return on.encode(n,!1)}function i(n){return on.decode(n)}function r(n){for(var t="",e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(n);i++)t+=e[Math.round(Math.random()*(e.length-1))];return t}function o(n){return!Number.isNaN(parseInt(n,10))}function a(n,t){for(var e=String(n).split("."),i=String(t).split("."),r=0;r<Math.max(e.length,i.length);r++){var o=parseInt(e[r]||0,10),a=parseInt(i[r]||0,10);if(o>a)return 1;if(o<a)return-1}return 0}function c(n){return JSON.parse(JSON.stringify(n))}function s(n,t){return!(!t||0===t.length||t.length>n.length)&&n.substr(0,t.length)===t}function u(n,t){return!(!t||0===n.length||t.length>n.length)&&n.substring(n.length-t.length)===t}function f(n){if(void 0===n||null===n)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(n),e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}function l(n){var t=null;switch(n){case mn.HALF_SESSION:t=h();break;case mn.CLOSE_SESSION:t=p();break;case mn.EKV:t=d()}return t}function h(){var n=null,t=In().cloneCurrentSession();t&&(n={header:{st:"1"},analytics:{sessions:[t]}});return n}function p(){var n=null,t={},e=In().cloneCurrentSession();if(e){var i=K().get(),r=un().get();Array.isArray(i)&&i.length&&(e.pages=an.clone(i));Array.isArray(r)&&r.length&&(e.shares=an.clone(r));K().clear();un().clear();t.sessions=[e]}var o=pn().getEkvs();if(o){t.ekvs=an.clone(o);pn().clear()}(t.sessions||t.ekvs)&&(n={analytics:t});return n}function d(){var n=null,t=pn().getEkvs();if(t){n={analytics:{ekvs:an.clone(t)}};pn().clear()}return n}function g(n){return{h:v(n.header,Nn),a:E(n.analytics,An)}}function v(n,t){var e=_(n,t);n.id_tracking&&(e[t.id_tracking||"id_tracking"]=_(n.id_tracking,Tn));return e}function _(n,t){var e={};for(var i in n)t[i]?e[t[i]]=n[i]:e[i]=n[i];return e}function E(n,t){var e={};if(n){var i=n.ekvs,r=n.sessions;i&&(e[t.ekvs]=i);Array.isArray(r)&&(e[t.sessions]=r)}return e}function y(n,e,i,r){Sn.instance().setIdType(cn().getIdType());Sn.instance().setIdTracking(cn().getIdTracking());var o=an.clone(Sn.instance().get());n.header=an.assign(o,n.header,{ts:Date.now()});var a=g(n),c=V.stringify(a),s={url:x.LOG_URL,method:"POST",data:an.base64Encode(c),success:function(n){var t=n.code||n.status||n.statusCode;if(200===t||413===t){b().i("数据发送成功: ",c);S((n.data||{}).imprint);"function"==typeof e&&e(n)}else{b().w("数据发送失败: ",c);"function"==typeof i&&i()}},fail:function(n){b().w("超时: ",c);"function"==typeof i&&i()},complete:function(){"function"==typeof r&&r()}};t(an.assign(s,m()))}function S(n){if(n){H().set(x.IMPRINT,n);Sn.instance().setItem(x.IMPRINT,n);var t=V.parse(an.base64Decode(n));b().v("imprint: %o",t);var e=t.report_policy;if(e&&an.isNumber(e)){H().set(x.REPORT_POLICY,e);if(e===x.REPORT_POLICY_INTERVAL){var i=t.report_interval;if(i&&an.isNumber(i)){i<=x.EVENT_SEND_MIN_INTERVAL?i=x.EVENT_SEND_MIN_INTERVAL:i>x.EVENT_SEND_MAX_INTERVAL&&(i=x.EVENT_SEND_MAX_INTERVAL);H().set(x.REPORT_INTERVAL_TIME,i)}}}}}function m(){;"alipaymp/json";return{headers:{"Content-Type":"alipaymp/json","Msg-Type":"alipaymp/json"}}}function I(n){var t=n,e=[];this.enqueue=function(n){"number"==typeof t&&this.size()>=t&&this.dequeue();e.push(n)};this.dequeue=function(){return e.shift()};this.front=function(){return e[0]};this.isEmpty=function(){return 0===e.length};this.clear=function(){e.length=0};this.size=function(){return e.length};this.items=function(){return e};this.print=function(){console.log(e.toString())}}function A(n,t){this.id=n;this.ts=Date.now();var e=typeof t;if("string"===e&&t)this[n]=t;else if("object"===e)for(var i in t)({}).hasOwnProperty.call(t,i)&&(this[i]=t[i])}function N(){function n(){cn().init(function(){Sn.instance().init();b().v("Header初始化成功")});t()}function t(){try{my.on("alipayAuthChange",function(n){n&&n.data&&n.data.authcode&&Sn.instance().updateExtraInfo()})}catch(n){b().e("绑定auth change异常: ",n)}}function e(n){var t=!1,e=H().get(x.REPORT_POLICY);if(e&&e===x.REPORT_POLICY_INTERVAL){var i=H().get(x.REPORT_INTERVAL_TIME),r=H().get(x.EVENT_LAST_SEND_TIME);t=!r;i=i||x.EVENT_SEND_MIN_INTERVAL;var o=n-r;t=t||o>1e3*i}return t}function i(n){H().set(x.EVENT_LAST_SEND_TIME,n)}function r(n,t){if(!n||"string"!=typeof n){b().e('please check trackEvent id. id should be "string" and not null');return!1}if(n.length>x.MAX_EVENTID_LENGTH){b().e("The maximum length of event id shall not exceed "+x.MAX_EVENTID_LENGTH);return!1}if(t&&("object"!=typeof t||Array.isArray(t))&&"string"!=typeof t){b().e("please check trackEvent properties. properties should be string or object(not include Array)");return!1}if("object"==typeof t){var e=0;for(var i in t)if({}.hasOwnProperty.call(t,i)){if(i.length>x.MAX_PROPERTY_KEY_LENGTH){b().e("The maximum length of property key shall not exceed "+x.MAX_PROPERTY_KEY_LENGTH);return!1}if(e>=x.MAX_PROPERTY_KEYS_COUNT){b().e("The maximum count of properties shall not exceed "+x.MAX_PROPERTY_KEYS_COUNT);return!1}e+=1}}return!0}var o,a=!1,c=!1;this.init=function(t){b().v("sdk version: "+x.IMPL_VERSION);a?b().v("Lib重复实例化"):H().load(function(){b().v("cache初始化成功: ",H().getAll());n();a=!0;"function"==typeof t&&t();b().tip("SDK集成成功")})};this.resume=function(n){if(a&&!c){b().v("showOptions: ",n);c=!0;var t=In().resume(n),e=In().getCurrentSessionId();pn().setSessionId(e);Dn().init(function(n){var e=void 0===o;o=n;if(n){var i=In().getCurrentSession();i.isNew=t;Dn().trackHalfSession(i);if(e){var r=K().getCurrentPage();r&&r.path&&Dn().enterPage(r.path)}}else{On().load();t&&On().add(mn.HALF_SESSION,function(){On().send()})}})}};this.pause=function(){if(a){c=!1;In().pause();o?Dn().trackClosedSession(In().getCurrentSession()):On().send(mn.CLOSE_SESSION,function(){On().save();H().save();b().v("cache save success")})}};this.setOpenid=function(n){if(!cn().getId()){b().v("setOpenId: %s",n);cn().setOpenid(n);On().send()}};this.setUnionid=function(n){b().v("setUnionid: %s",n);cn().setUnionid(n)};this.setUserid=function(n){b().v("setUserid: %s",n);cn().setUserid(n)};this.trackEvent=function(n,t){if(a){b().v("event: ",n,t);if(r(n,t)){var c=new A(n,t);if(o)Dn().trackEvent(c);else{pn().addEvent(c);var s=Date.now();if(e(s)){i(s);On().send(mn.EKV,function(){})}}}}};this.trackShare=function(n){if(a){try{n=un().add(n);b().v("sharePath: ",n.path)}catch(n){b().v("shareAppMessage: ",n)}return n}};this.trackPageStart=function(n){a&&(o?Dn().enterPage(n):K().addPageStart(n))};this.trackPageEnd=function(n){a&&(o?Dn().leavePage(n):K().addPageEnd(n))}}function T(){}function O(n,t,e){var i=n[t];n[t]=function(n){e.call(this,n);i&&i.call(this,n)}}function k(n){try{Yn.init(n)}catch(n){b().v("onAppLaunch: ",n)}}function R(n){try{Mn=n?an.clone(n):{};b().v("App onShow: ",n,Mn)}catch(n){b().v("onAppShow: ",n)}}function L(){try{Yn.pause()}catch(n){b().v("onAppHide: ",n)}}function P(n){try{if(n){Mn.query=Mn.query||{};an.assign(Mn.query,n)}b().v("Page onLoad: ",n,Mn)}catch(n){b().v("onPageLoad: ",n)}}function C(){try{Yn.resume(Mn);Yn.trackPageStart(this.route)}catch(n){b().v("onPageShow: ",n)}}function w(){try{Yn.trackPageEnd(this.route)}catch(n){b().v("onPageHide: ",n)}}var D="[UMENG] -- ",b=function(){function n(){this.setDebug=function(n){e=n};this.d=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=D+arguments[0]);console.debug.apply(console,arguments)}catch(n){}};this.i=function(){try{if(e)try{"string"==typeof arguments[0]&&(arguments[0]=D+arguments[0]);console.info.apply(console,arguments)}catch(n){}}catch(n){}};this.e=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=D+arguments[0]);console.error.apply(console,arguments)}catch(n){}};this.w=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=D+arguments[0]);console.warn.apply(console,arguments)}catch(n){}};this.v=function(){if(e)try{"string"==typeof arguments[0]&&(arguments[0]=D+arguments[0]);console.log.apply(console,arguments)}catch(n){}};this.t=function(){if(e)try{console.table.apply(console,arguments)}catch(n){}};this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]=D+arguments[0]);console.log.apply(console,arguments)}catch(n){}};this.tip_w=function(){try{"string"==typeof arguments[0]&&(arguments[0]=D+arguments[0]);console.warn.apply(console,arguments)}catch(n){}};this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]=D+arguments[0]);console.error.apply(console,arguments)}catch(n){}}}var t=null,e=!1;return function(){null===t&&(t=new n);return t}}(),M={set:function(n,t,e){var i,r={key:n,success:function(n){"function"==typeof e&&e(n)},fail:function(){"function"==typeof e&&e()}};r.data=t;i=my.setStorage;try{i&&i(r)}catch(n){b.e("存储错误",n)}},get:function(n,t){var e;e=my.getStorage;try{e&&e({key:n,success:function(n){"function"==typeof t&&t(n.data)},fail:function(e){b().w(n+": "+e.errMsg);"function"==typeof t&&t()}})}catch(n){b.e("获取storage错误",n)}},remove:function(n,t){var e;e=my.removeStorage;try{e&&e({key:n,success:function(){"function"==typeof t&&t(!0)},fail:function(){"function"==typeof t&&t(!1)}})}catch(n){b.e("删除storage错误",n)}}},V={stringify:function(n){if(n)try{return JSON.stringify(n)}catch(n){}return""},parse:function(n){if(n)try{return JSON.parse(n)}catch(n){}return null},parseToArray:function(n){if(n)try{return JSON.parse(n)}catch(n){}return[]}},U=function(){function n(){var n={};this.appKey=function(){return n.appKey};this.set=function(t){n=t};this.get=function(){return n};this.setItem=function(t,e){n[t]=e};this.getItem=function(t){return n[t]}}var t=null;return function(){t||(t=new n);return t}}(),H=function(){function n(){this.load=function(n){if(i){M.remove(e);n()}else{e="um_cache_"+U().appKey();M.get(e,function(t){i=V.parse(t)||{};r=!0;M.remove(e);n()})}};this.save=function(){i&&M.set(e,V.stringify(i))};this.set=function(n,t){i&&(i[n]=t)};this.get=function(n){return(i||{})[n]};this.remove=function(n){i&&i[n]&&delete i[n]};this.getAll=function(){return i};this.clear=function(){i=null};this.has=function(n){return!!this.get(n)};this.isLoaded=function(){return r}}var t=null,e="",i=null,r=!1;return function(e){t||(t=new n(e));return t}}(),Y="",x={SESSION_INTERVAL:3e4,LOG_URL:Y="https://ulogs.umeng.com/alipaym_logs",GET_OPENID_URL:"https://ulogs.umeng.com/uminiprogram_logs/wx/getuut",DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",CURRENT_SESSION:"current_session",SESSION_PAUSE_TIME:"session_pause_time",EVENT_SEND_MIN_INTERVAL:5,EVENT_SEND_MAX_INTERVAL:86400,EVENT_LAST_SEND_TIME:"last_send_time",MAX_EVENTID_LENGTH:128,MAX_PROPERTY_KEY_LENGTH:256,MAX_PROPERTY_KEYS_COUNT:100,REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT:"imprint",SEED_VERSION:"1.0.0",IMPL_VERSION:"2.2.1-1",ALIPAY_AVAILABLE_VERSION:"10.1.52",SHARE_PATH:"um_share_path",SHARES:"shares",REQUESTS:"requests",UUID:"um_uuid",UUID_SUFFIX:"ud",OPENID:"um_od",UNIONID:"um_unid",ALIPAYID:"um_alipayid",USERID:"um_userid",LAUNCH_OPTIONS:"LAUNCH_OPTIONS",UM_SSRC:"_um_ssrc",IS_ALIYUN:!1,ALIYUN_URL:"serverless.huoban.youmeng.network.forward"},G={getUserInfo:function(n){my.getSetting({success:function(t){t.authSetting.userInfo?my.getOpenUserInfo({success:t=>{let e=JSON.parse(t.response).response;n({userInfo:e})},fail:function(){n({})}}):n({})},fail:function(){n({})}})},getSystemInfo:function(n,t){my.getSystemInfo({success:function(t){"function"==typeof n&&n(t)},fail:function(){"function"==typeof t&&t()}})},getDeviceInfo:function(n){try{my.call("getDeviceInfo",{},function(t){var e=(t||{}).data;if(e){H().set(x.DEVICE_INFO_KEY,e);"function"==typeof n&&n(e)}else{var i=H().get(x.DEVICE_INFO_KEY);"function"==typeof n&&n(i)}})}catch(n){b().w("支付宝获取设备info 失败",n)}},checkNetworkAvailable:function(n){var t={success:function(t){var e=!1;e=t.networkAvailable;"function"==typeof n&&n(e)},fail:function(){"function"==typeof n&&n()}};my.getNetworkType(t)},getNetworkInfo:function(n,t){var e={success:function(t){"function"==typeof n&&n(t)},fail:function(){"function"==typeof t&&t()}};my.getNetworkType(e)},getDeviceId:function(n,t){try{"function"==typeof n&&n("")}catch(n){b().e("getDeviceId error",n)}},getAdvertisingId:function(n,t){"function"==typeof n&&n("")},getPageName:function(){},onNetworkStatusChange:function(n){my.onNetworkStatusChange(function(t){"function"==typeof n&&n(t.isConnected||!0)})}},K=function(){function n(){var n=!1,t=null,e=[];this.addPageStart=function(e){if(e&&!n){t={ts:Date.now(),path:e};n=!0}};this.addPageEnd=function(i){if(n&&i&&t&&i===t.path){var r=Date.now()-t.ts;t.duration=Math.abs(r);e.push(t);t=null;n=!1}};this.get=function(){return e};this.getCurrentPage=function(){return t};this.clear=function(){e.length=0}}var t=null;return function(){t||(t=new n);return t}}(),F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q=function(n){for(var t={},e=0,i=n.length;e<i;e++)t[n.charAt(e)]=e;return t}(F),X=String.fromCharCode,j=function(n){if(n.length<2)return(t=n.charCodeAt(0))<128?n:t<2048?X(192|t>>>6)+X(128|63&t):X(224|t>>>12&15)+X(128|t>>>6&63)+X(128|63&t);var t=65536+1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320);return X(240|t>>>18&7)+X(128|t>>>12&63)+X(128|t>>>6&63)+X(128|63&t)},B=function(n){return n.replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,j)},J=function(n){var t=[0,2,1][n.length%3],e=n.charCodeAt(0)<<16|(n.length>1?n.charCodeAt(1):0)<<8|(n.length>2?n.charCodeAt(2):0);return[F.charAt(e>>>18),F.charAt(e>>>12&63),t>=2?"=":F.charAt(e>>>6&63),t>=1?"=":F.charAt(63&e)].join("")},W=function(n){return n.replace(/[\s\S]{1,3}/g,J)},z=function(n){return W(B(n))},Q=function(n,t){return t?z(String(n)).replace(/[+\/]/g,function(n){return"+"==n?"-":"_"}).replace(/=/g,""):z(String(n))},Z=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),$=function(n){switch(n.length){case 4:var t=((7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3))-65536;return X(55296+(t>>>10))+X(56320+(1023&t));case 3:return X((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return X((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},nn=function(n){return n.replace(Z,$)},tn=function(n){var t=n.length,e=t%4,i=(t>0?q[n.charAt(0)]<<18:0)|(t>1?q[n.charAt(1)]<<12:0)|(t>2?q[n.charAt(2)]<<6:0)|(t>3?q[n.charAt(3)]:0),r=[X(i>>>16),X(i>>>8&255),X(255&i)];r.length-=[0,0,2,1][e];return r.join("")},en=function(n){return n.replace(/[\s\S]{1,4}/g,tn)},rn=function(n){return nn(en(n))},on={encode:Q,decode:function(n){return rn(String(n).replace(/[-_]/g,function(n){return"-"==n?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}},an={base64Encode:e,base64Decode:i,isNumber:o,compareVersion:a,getRandomStr:r,clone:c,startsWith:s,endsWith:u,assign:f},cn=function(){function n(){function n(n){try{my.call("getOpenUserData",{},function(t){var e=(t||{}).uid;e||b().err('请确保已经勾选支付宝功能包中的"友盟+数据服务"功能包！');"function"==typeof n&&n(e)})}catch(t){n("")}}var t="",e="",i="",r="",o="";this.init=function(t){o="alipay_id";M.get(x.ALIPAYID,function(e){if(e){r=e;t&&t()}else n(function(n){b().v("获取到alipayid: %s",n);r=n;M.set(x.ALIPAYID,r);t&&t()})})};this.getIdType=function(){return o};this.getIdTracking=function(){var n={};t&&(n.openid=t);e&&(n.unionid=e);r&&(n.alipay_id=r);i&&(n.userid=i);return n};this.setOpenid=function(n){if(!t&&n){t=n;M.set(x.OPENID,n)}};this.setUnionid=function(n){if(!e&&n){e=n;M.set(x.UNIONID,n)}};this.setUserid=function(n){if(!i&&n){i=n;M.set(x.USERID,n)}};this.getId=function(){return r}}var t=null;return function(){t||(t=new n);return t}}(),sn=3,un=function(){function n(){return{add:function(n){b().v("share origin: %o",n);var t={title:n.title,path:n.path.split("?")[0],_um_sts:Date.now()},r=n.path,o=cn().getId();if(o){var a=i.split(","),c=(a=a.filter(function(n){return n.length>0})).indexOf(o);c>=0&&(a=a.slice(0,c));a.length<sn&&a.push(o);var s=a.join(",");-1!==r.indexOf("?")?r+="&_um_ssrc="+s:r+="?_um_ssrc="+s;var u=Date.now();r+="&_um_sts="+u;n.path=r;t._um_ssrc=s;t._um_sts=u}e.push(t);b().v("share: %o",n);return n},setShareSource:function(n){i=n},clear:function(){e.length=0},get:function(){return e}}}var t=null,e=[],i="";return function(){t||(t=new n);return t}}(),fn="ekvs",ln=1e4,hn=1,pn=function(){function n(){if(a.length){var n=H().get(fn);if(e(n)+a.length<=ln){n=t(n,a);H().set(fn,n)}}}function t(n,t){var e=(n=n||{})[o];Array.isArray(e)&&e.length?n[o]=e.concat(t):n[o]=[].concat(t);return n}function e(n){var t=0;for(var e in n)Array.isArray(n[e])&&(t+=n[e].length);return t}function i(){return{addEvent:function(t){if(o){a.unshift(t);if(a.length>hn){n(o);a.length=0}}else{b().w("session id is null: ",o);c.unshift(t)}},setSessionId:function(n){o=n;b().v("setSessionId: ",o);if(Array.isArray(c)&&c.length&&o){for(var t=0;t<c.length;t++)this.addEvent(c[t]);c.length=0}},getEkvs:function(){var n=H().get(fn);a&&a.length&&(n=t(n,a));return n},clear:function(){H().remove(fn);a.length=0}}}var r,o,a=[],c=[];return function(){r||(r=i());return r}}(),dn="2g",gn="3g",vn="4g",_n="none",En=" ",yn=["access","access_subtype"],Sn=function(){function n(){function n(n){G.getSystemInfo(function(i){G.getNetworkInfo(function(o){var a=o.type||o.networkType;a===_n&&(a="unknown");var c=H().get(x.IMPRINT);c&&(r.imprint=c);t(i,a);e(i);n&&n()})})}function t(n,t,e){r.userInfo=e;r.device_type="Phone";r.sdk_version=x.IMPL_VERSION;r.appkey=U().appKey();if(n){var i,o,a,c=n.model||"",s=(n.product,n.platform||""),u=n.brand||"",f=u.toLowerCase();r.platform_version=n.version;if("android"===s){i=Math.round(n.screenWidth);o=Math.round(n.screenHeight)}else{i=Math.round(n.screenWidth*n.pixelRatio);o=Math.round(n.screenHeight*n.pixelRatio)}a=i>o?i+"*"+o:o+"*"+i;r.os=s;r.font_size_setting=n.fontSizeSetting;r.device_model=c.toLowerCase().indexOf(f)>-1?c:f+En+c;r.device_brand=u;r.device_manufacturer=f;r.device_manuid=c.toLowerCase().indexOf(f)>-1?c:f+En+c;r.device_name=c.toLowerCase().indexOf(f)>-1?c:f+En+c;r.os_version=n.system;r.resolution=a;r.language=n.language}switch(t){case vn:r.access_subtype="LTE";r.access="4G";break;case gn:r.access_subtype="CDMA";r.access="3G";break;case dn:r.access_subtype="GRPS";r.access="2G";break;default:r.access=t;delete r.access_subtype}}function e(n){var t=[];if(n){t.push({name:"系统名",value:n.platform});t.push({name:"宿主客户端版本号",value:n.version})}t.push({name:"设备型号",value:r.device_model});t.push({name:"设备生产商",value:r.device_brand});t.push({name:"os版本号",value:r.os_version});t.push({name:"网络类型",value:r.access});t.push({name:"运营商",value:r.access_subtype});t.push({name:"分辨率",value:r.resolution});t.push({name:"screenWidth",value:n.screenWidth});t.push({name:"screenHeight",value:n.screenHeight});t.push({name:"pixelRatio",value:n.pixelRatio});for(var e="",i=0;i<t.length;i++){var o=t[i];e+=o.name+": "+o.value+"; "}b().v("调试辅助信息: ",e)}var i=!1,r={};r.sdk_type="alipaymp";r.platform="alipay";r.platform_sdk_version=my.SDKVersion;return{init:function(){this.updateExtraInfo();n(function(){i=!0})},isLoaded:function(){return i},get:function(){return r},getSDKType:function(){return r.sdk_type},getPlatform:function(){return r.platform},getRealtimeFields:function(){var n={};yn.forEach(function(t){n[t]=r[t]});return n},setIdTracking:function(n){this.setItem("id_tracking",n)},setIdType:function(n){this.setItem("id_type",n)},setItem:function(n,t){r[n]=t},getItem:function(n){return r[n]},updateExtraInfo:function(){G.getDeviceInfo(function(n){r.device_info=n||""})}}}var t=null;return{instance:function(){t||(t=n());return t}}}(),mn={HALF_SESSION:"half_session",CLOSE_SESSION:"close_session",EKV:"ekv",ENTER_PAGE:"enter_page",LEAVE_PAGE:"leave_page"},In=function(){function n(){return{resume:function(n){var t=!1;a||(a=H().get(x.CURRENT_SESSION));var i=new Date;o=i.getTime();if(!a||!a.end_time||o-a.end_time>x.SESSION_INTERVAL){t=!0;e(n);b().v("开始新的session(%s): ",a.id,a)}else b().v("延续上一次session(%s): %s ",a.id,i.toLocaleTimeString(),a);return t},pause:function(){i()},getCurrentSessionId:function(){return(a||{}).id},getCurrentSession:function(){return a},cloneCurrentSession:function(){return an.clone(a)}}}function t(n){var t={};for(var e in n)0===e.indexOf("_um_")&&(t[e]=n[e]);return t}function e(n){try{var e=(a||{}).options||{},i=an.assign({},t(n.query));i.path=n.path||e.path;i.scene=n.scene?Sn.instance().getPlatform()+"_"+n.scene:e.scene;b().v("session options: ",i);var r=i[x.UM_SSRC];r&&un().setShareSource(r);var o=Date.now();a={id:an.getRandomStr(10)+o,start_time:o,options:i}}catch(n){b().e("生成新session失败: ",n)}}function i(){if(a){var n=new Date;a.end_time=n.getTime();"number"!=typeof a.duration&&(a.duration=0);a.duration=a.end_time-o;H().set(x.CURRENT_SESSION,a);b().v("退出会话(%s): %s ",a.id,n.toLocaleTimeString(),a)}}var r=null,o=null,a=null;return function(){r||(r=n());return r}}(),An={sessions:"sn",ekvs:"e"},Nn={sdk_type:"sdt",access:"ac",access_subtype:"acs",device_model:"dm",language:"lang",device_type:"dt",device_manufacturer:"dmf",device_name:"dn",platform_version:"pv",id_type:"it",font_size_setting:"fss",os_version:"ov",device_manuid:"did",platform_sdk_version:"psv",device_brand:"db",appkey:"ak",_id:"id",id_tracking:"itr",imprint:"imp",sdk_version:"sv",resolution:"rl"},Tn={uuid:"ud",unionid:"und",openid:"od",alipay_id:"ad",device_id:"dd",userid:"puid"},On=function(){function n(t,e){if(Sn.instance().isLoaded()){var i=l(t),r=Sn.instance().getRealtimeFields();i.header=an.assign({},i.header,r);s.enqueue(i);"function"==typeof e&&e()}else setTimeout(function(){n(t,e)},100)}function t(n){var i=s.front(),r=function(){s.dequeue();t(n)},o=function(){var e=s.dequeue();e&&c.push(e);t(n)};if(i)y(i,r,o);else{e();n()}}function e(){c.forEach(function(n){s.enqueue(n)});c.length=0}function i(n){if(cn().getId())a?b().i("队列正在发送中"):G.checkNetworkAvailable(function(e){if(!1!==e){a=!0;t(function(){a=!1;"function"==typeof n&&n()})}else"function"==typeof n&&n()});else{b().i("获取id标识失败，暂缓发送");"function"==typeof n&&n()}}function r(){this.send=function(n,t){n?this.add(n,function(){i(t)}):i(t)};this.add=function(t,e){n(t,e)};this.load=function(){var n=H().get(x.REQUESTS);n&&n.length&&n.forEach(function(n){s.enqueue(n)});H().remove(x.REQUESTS)};this.save=function(){H().set(x.REQUESTS,an.clone(s.items()));s.clear()}}var o=null,a=!1,c=[],s=new I(50);return function(){o||(o=new r);return o}}(),kn={getClipboard:function(n){var t;t=my.getClipboard;try{t&&t({success:function(t){var e=t.text;"function"==typeof n&&n(e)},fail:function(){"function"==typeof n&&n("")}})}catch(n){b.e("读取clipboard发生错误",n)}},showModal:function(n){var t;t=my.confirm;n.confirmButtonText=n.confirmText;n.cancelButtonText=n.cancelText;try{t&&t(n)}catch(n){b.e("展示Modal时发生错误",n)}},showToast:function(n){var t;t=my.showToast;n.content=n.title;try{t&&t(n)}catch(n){b.e("showToast error",n)}}},Rn={connectSocket:function(n){var t;if(t=my.connectSocket)return t(n)},closeSocket:function(n){var t;(t=my.closeSocket)&&t(n)},send:function(n){var t;(t=my.sendSocketMessage)&&t(n)},onSocketOpen:function(n){var t;(t=my.onSocketOpen)&&t(n)},onSocketClose:function(n){var t;(t=my.onSocketClose)&&t(n)},onSocketMessage:function(n){var t;(t=my.onSocketMessage)&&t(n)},onSocketError:function(n){var t;(t=my.onSocketError)&&t(n)}},Ln="_UMTEST_",Pn="LAST_TEST_TOKEN",Cn={READY:"READY",NO_RECV:"NO_RECV",RECV_EXIT:"RECV_EXIT",HALF_SESSION:"HALF_SESSION",CLOSED_SESSION:"CLOSED_SESSION",EVENT:"EVENT",ENTER_PAGE:"ENTER_PAGE",LEAVE_PAGE:"LEAVE_PAGE",BATCH:"BATCH"},wn="ws://192.168.1.100:3000/send",Dn=function(){function n(){function n(){console.log("connent open")}function t(){a()}function o(n){try{switch((JSON.parse(n.data)||{}).type){case Cn.READY:e=!0;kn.showToast({title:"开始验证"});if(r.length){c(Cn.BATCH,r);r.length=0}break;case Cn.NO_RECV:case Cn.RECV_EXIT:u&&u.close();a();i&&M.set(Pn,i.token);kn.showModal({title:"结束验证",content:"网站端已退出验证，如需继续验证请到网站端重新扫码",showCancel:!1})}}catch(n){b.w(n)}}function a(){e=!1;u=null}function c(n,t){try{if(!u)return;e?Rn.send({data:JSON.stringify({type:n,appkey:i.appkey,token:i.token,data:t})}):r.push(t)}catch(n){b().w(n)}}function s(e){if(e&&e.token){u=Rn.connectSocket({url:wn+"?token="+e.token});Rn.onSocketOpen(n);Rn.onSocketClose(t);Rn.onSocketMessage(o)}}var u=null;this.init=function(n){if(u)return n(!0);kn.getClipboard(function(t){try{if(t&&an.startsWith(t,Ln)&&t.split(Ln)[1]){var e=t.split(Ln)[1],r=JSON.parse(on.decode(e));if(r.appkey===U().appKey())return M.get(Pn,function(t){if(!t||r.token!==t){i=r;s(r);return n(!0)}n(!1)})}n(!1)}catch(t){n(!1);b().v(t)}})};this.isTesting=function(){return!!u};this.trackHalfSession=function(n){c(Cn.HALF_SESSION,{dataType:mn.HALF_SESSION,data:n})};this.trackClosedSession=function(n){c(Cn.CLOSED_SESSION,{dataType:mn.CLOSE_SESSION,data:n})};this.trackEvent=function(n){c(Cn.EVENT,{dataType:mn.EKV,data:n})};this.enterPage=function(n){c(Cn.ENTER_PAGE,{dataType:mn.ENTER_PAGE,data:n})};this.leavePage=function(n){c(Cn.LEAVE_PAGE,{dataType:mn.LEAVE_PAGE,data:n})}}var t=null,e=!1,i=null,r=[];return function(){t||(t=new n);return t}}(),bn=[];T.prototype={createMethod:function(n,t,e){try{n[t]=e?function(){return e[t].apply(e,arguments)}:function(){bn.push([t,[].slice.call(arguments)])}}catch(n){b().v("create method errror: ",n)}},installApi:function(n,t){try{var e,i,r=["resume","pause","trackEvent","trackPageStart","trackPageEnd","trackShare","setOpenid","setUnionid","setUserid"];for(e=0,i=r.length;e<i;e++)this.createMethod(n,r[e],t);if(t)for(e=0,i=bn.length;e<i;e++){var o=bn[e];try{t[o[0]].apply(t,o[1])}catch(n){b().v("impl[v[0]].apply error: ",o[0],n)}}}catch(n){b().v("install api errror: ",n)}}};var Mn={};try{var Vn=App;App=function(n){O(n,"onLaunch",function(){k(n.umengConfig)});O(n,"onShow",R);O(n,"onHide",L);if(n.onShareAppMessage){var t=n.onShareAppMessage;n.onShareAppMessage=function(n){var e=t.call(this,n);return Yn.trackShare.call(this,e)}}Vn(n)}}catch(n){b().w("App重写异常")}try{var Un=Page;Page=function(n){O(n,"onShow",C);O(n,"onHide",w);O(n,"onUnload",w);O(n,"onLoad",P);if(n.onShareAppMessage){var t=n.onShareAppMessage;n.onShareAppMessage=function(n){var e=t.call(this,n);return Yn.trackShare.call(this,e)}}Un(n)}}catch(n){b().w("Page重写异常")}var Hn=new T,Yn={_inited:!1,init:function(n){function t(n){try{var t=new N;b().v("成功创建Lib对象");t.init(function(){b().v("Lib对象初始化成功");Hn.installApi(n,t);b().v("安装Lib接口成功")})}catch(n){b().w("创建Lib对象异常: "+n)}}if(this._inited)b().v("已经实例过，请避免重复初始化");else if(n)if(n.appKey){U().set(n);b().setDebug(n.debug);this._inited=!0;var e=this;G.getSystemInfo(function(n){n&&n.version&&"alipay"===n.app&&an.compareVersion(n.version,x.ALIPAY_AVAILABLE_VERSION)<0?b().err("只支持版本号大于等于10.1.52的支付宝客户端！"):t(e)})}else b().err("请确保传入正确的appkey");else b().err("请通过在App内添加umengConfig设置相关信息！")}};try{Hn.installApi(Yn,null);b().v("安装临时接口成功");my.uma=Yn}catch(n){b().w("uma赋值异常: ",n)}module.exports=Yn;
